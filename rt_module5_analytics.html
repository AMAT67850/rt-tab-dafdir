<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ ROCKET TOWER - Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .info-section {
            color: white;
            text-align: right;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #667eea;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #666;
            font-size: 0.9em;
            font-weight: 500;
        }

        .positive {
            color: #28a745;
        }

        .negative {
            color: #dc3545;
        }

        .neutral {
            color: #6c757d;
        }

        .chart-container {
            height: 400px;
            margin-top: 20px;
        }

        .table-container {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-actif {
            background: #d4edda;
            color: #155724;
        }

        .status-suspendu {
            background: #f8d7da;
            color: #721c24;
        }

        .explanation-section {
            grid-column: 1 / -1;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .explanation-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .explanation-item h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .explanation-item p {
            color: #666;
            line-height: 1.5;
        }

        @media print {
            body {
                background: white;
            }
            
            .controls {
                display: none;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .print-info {
                display: block !important;
                margin-bottom: 20px;
                padding: 10px;
                border: 1px solid #ddd;
                background: #f8f9fa;
            }
        }

        .print-info {
            display: none;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .sync-indicator:hover {
            transform: scale(1.1);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: "‚è≥";
            font-size: 2em;
            display: block;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Analytics Dashboard</h1>
            <p>Tableau de bord financier consolid√© - <span id="infoSources">Chargement...</span></p>
        </div>

        <div class="controls">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="actualiserDonnees()">üîÑ Actualiser</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Imprimer</button>
                <a href="index.html" class="btn btn-secondary">üè† Accueil</a>
                <a href="rocket_tower_sync_system.html" class="btn btn-secondary">üîÑ Synchronisation</a>
            </div>
            <div class="info-section">
                <p><strong>Derni√®re mise √† jour :</strong> <span id="derniereMiseAJour">-</span></p>
                <p id="infoCalcul">Calcul en cours...</p>
            </div>
        </div>

        <!-- Indicateur de synchronisation -->
        <div class="sync-indicator" onclick="actualiserDonnees()" title="Synchronisation Multi-Utilisateurs">
            üìä
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value positive" id="totalRecettes">‚Ç¨ -</div>
                <div class="metric-label">üí∞ Total Recettes Liss√©es HT</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value negative" id="totalCharges">‚Ç¨ -</div>
                <div class="metric-label">üí∏ Total Charges Liss√©es HT</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="resultatMensuel">‚Ç¨ -</div>
                <div class="metric-label">üìä R√©sultat Mensuel HT</div>
            </div>
            
            <div class="metric-card">
                <div class="metric-value" id="ratioCharges">- %</div>
                <div class="metric-label">‚öñÔ∏è Ratio Charges/Recettes</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>üìà R√©partition des Recettes</h2>
                <div id="repartitionRecettes" class="loading">Chargement des donn√©es...</div>
            </div>
            
            <div class="card">
                <h2>üìâ R√©partition des Charges</h2>
                <div id="repartitionCharges" class="loading">Chargement des donn√©es...</div>
            </div>
        </div>

        <div class="card">
            <h2>üìã D√©tail des Op√©rations</h2>
            <div class="table-container">
                <table id="tableauOperations">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Montant HT</th>
                            <th>P√©riodicit√©</th>
                            <th>Statut</th>
                            <th>Liss√© Mensuel HT</th>
                        </tr>
                    </thead>
                    <tbody id="listeOperations">
                        <tr><td colspan="6" class="loading">Chargement...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="explanation-section">
            <h2>üìö Guide d'Interpr√©tation des KPIs</h2>
            <div class="explanation-grid">
                <div class="explanation-item">
                    <h4>‚öñÔ∏è Ratio Charges/Recettes</h4>
                    <p>Pourcentage des charges par rapport aux recettes : Charges √∑ Recettes √ó 100. 
                    Plus ce ratio est faible, meilleure est la rentabilit√©.</p>
                </div>
                <div class="explanation-item">
                    <h4>üìà Marge Op√©rationnelle</h4>
                    <p>Pourcentage de recettes restant apr√®s d√©duction des charges : (Recettes - Charges) / Recettes √ó 100</p>
                </div>
                <div class="explanation-item">
                    <h4>‚öñÔ∏è √âquilibre Financier</h4>
                    <p>Atteint si Recettes ‚â• Charges absolues (r√©sultat ‚â• 0). Indique la viabilit√© financi√®re.</p>
                </div>
                <div class="explanation-item">
                    <h4>üìÖ Totaux Liss√©s HT</h4>
                    <p>Montants HT ajust√©s selon la p√©riodicit√© : trimestriel √∑3, semestriel √∑6, annuel √∑12 pour obtenir l'√©quivalent mensuel hors taxes.</p>
                </div>
            </div>
        </div>

        <!-- INFORMATIONS POUR IMPRESSION - MASQU√âES √Ä L'√âCRAN -->
        <div class="print-info">
            <p><strong>üöÄ ROCKET TOWER - ANALYTICS DASHBOARD</strong></p>
            <p>Rapport g√©n√©r√© le <span id="dateImpression"></span> √† <span id="heureImpression"></span></p>
            <p>Sources : <span id="sourcesImpression">Modules Recettes + Charges r√©currentes</span></p>
            <p>Totaux calcul√©s automatiquement avec lissage p√©riodicit√© ‚Ä¢ G√©n√©r√© automatiquement</p>
        </div>
    </div>

    <script>
        // Variables globales
        let recettesData = [];
        let chargesData = [];
        let analytics = {
            totalRecettesLissees: 0,
            totalChargesLissees: 0,
            resultatMensuel: 0,
            ratioChargesRecettes: 0,
            margeOperationnelle: 0,
            equilibreFinancier: "NON ATTEINT"
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            actualiserDonnees();
        });

        function actualiserDonnees() {
            console.log('üîÑ Actualisation des donn√©es Analytics...');
            
            chargerDonneesLocalStorage();
            calculerAnalytics();
            afficherResultats();
            afficherRepartitions();
            
            console.log('‚úÖ Analytics mis √† jour');
        }

        function chargerDonneesLocalStorage() {
            try {
                // ========================================
                // LECTURE MODULE 2 (RECETTES) - ROBUSTE
                // ========================================
                console.log('üì• Chargement Module 2 (Recettes)...');
                const recettesJSON = localStorage.getItem('recettesRT');
                if (recettesJSON) {
                    const toutesRecettes = JSON.parse(recettesJSON);
                    // FILTRAGE S√âCURIS√â - v√©rifier que statut existe
                    recettesData = toutesRecettes.filter(r => {
                        // V√©rification existence du champ statut
                        if (!r.hasOwnProperty('statut')) {
                            console.warn('‚ö†Ô∏è Recette sans champ statut d√©tect√©e:', r);
                            return true; // Inclure par d√©faut si pas de statut
                        }
                        return r.statut === 'ACTIF';
                    });
                    
                    console.log(`üìä Recettes - Total: ${toutesRecettes.length}, Actives: ${recettesData.length}`);
                    
                    // DEBUG D√âTAILL√â
                    let totalRecettesDebug = 0;
                    let totalRecettesLisseDebug = 0;
                    recettesData.forEach(r => {
                        // V√©rification s√©curis√©e des montants
                        const montantHT = r.montantHT || 0;
                        const periodicite = r.periodicite || 'MENSUEL';
                        
                        totalRecettesDebug += montantHT;
                        totalRecettesLisseDebug += calculerMontantLisse({ montantHT, periodicite });
                    });
                    console.log(`üìä Recettes DEBUG - Total: ${Math.round(totalRecettesDebug)}‚Ç¨, Liss√©: ${Math.round(totalRecettesLisseDebug)}‚Ç¨`);
                } else {
                    recettesData = [];
                    console.warn('‚ö†Ô∏è Aucune donn√©e recettes trouv√©e');
                }

                // ========================================
                // LECTURE MODULE 3 (CHARGES) - SUPER ROBUSTE
                // ========================================
                console.log('üì• Chargement Module 3 (Charges r√©currentes)...');
                const chargesJSON = localStorage.getItem('chargesRecurrentesRT');
                if (chargesJSON) {
                    const toutesCharges = JSON.parse(chargesJSON);
                    console.log(`üìä Total charges dans localStorage: ${toutesCharges.length}`);
                    
                    // FILTRAGE ULTRA S√âCURIS√â pour charges
                    chargesData = toutesCharges.filter(c => {
                        // Validation structure minimale requise
                        if (!c || typeof c !== 'object') {
                            console.warn('‚ö†Ô∏è Charge invalide d√©tect√©e:', c);
                            return false;
                        }
                        
                        // V√©rifier champs obligatoires
                        if (!c.hasOwnProperty('montantHT') || isNaN(c.montantHT)) {
                            console.warn('‚ö†Ô∏è Charge sans montantHT valide:', c);
                            return false;
                        }
                        
                        // Gestion statut (nouveau champ avec les types)
                        if (!c.hasOwnProperty('statut')) {
                            console.log('‚ÑπÔ∏è Charge sans champ statut - incluse par d√©faut:', c.element || 'Sans nom');
                            return true; // Inclure les anciennes charges sans statut
                        }
                        
                        return c.statut === 'ACTIF';
                    });
                    
                    console.log(`üìä Charges actives filtr√©es: ${chargesData.length}`);
                    
                    // DEBUG ULTRA D√âTAILL√â
                    let totalChargesDebug = 0;
                    let totalChargesLisseDebug = 0;
                    chargesData.forEach((c, index) => {
                        const montantHT = Math.abs(c.montantHT || 0); // Valeur absolue pour les charges
                        const periodicite = c.periodicite || 'MENSUEL';
                        const montantLisse = calculerMontantLisse({ montantHT, periodicite });
                        
                        totalChargesDebug += montantHT;
                        totalChargesLisseDebug += montantLisse;
                        
                        // Log d√©taill√© des 5 premi√®res charges
                        if (index < 5) {
                            console.log(`  Charge ${index + 1}: ${c.element || 'Sans nom'} - ${montantHT}‚Ç¨ HT (${periodicite}) = ${montantLisse.toFixed(2)}‚Ç¨ liss√©`);
                        }
                    });
                    
                    console.log(`üìä Charges DEBUG - Total: ${Math.round(totalChargesDebug)}‚Ç¨, Liss√©: ${Math.round(totalChargesLisseDebug)}‚Ç¨`);
                    console.log(`üéØ TARGET: Doit correspondre √† ~2800‚Ç¨ liss√© pour obtenir 9094‚Ç¨ final`);
                    
                } else {
                    chargesData = [];
                    console.warn('‚ö†Ô∏è Aucune donn√©e charges trouv√©e');
                }

                // Mise √† jour interface
                document.getElementById('infoSources').textContent = 
                    `Sources : ${recettesData.length} recettes + ${chargesData.length} charges actives`;

                // LOG FINAL CONSOLID√â
                console.log('‚úÖ === CHARGEMENT TERMIN√â ===');
                console.log(`üìä BILAN FINAL:`, {
                    recettes: recettesData.length,
                    charges: chargesData.length,
                    total_operations: recettesData.length + chargesData.length
                });

            } catch (error) {
                console.error('‚ùå Erreur critique chargement localStorage:', error);
                recettesData = [];
                chargesData = [];
                
                document.getElementById('infoSources').textContent = 
                    'Erreur chargement donn√©es';
            }
        }

        function calculerMontantLisse(item) {
            // Fonction ROBUSTE de calcul lissage p√©riodicit√©
            let facteurLissage = 1;
            const periodicite = item.periodicite || 'MENSUEL';
            const montantHT = Math.abs(item.montantHT || 0);
            
            switch (periodicite.toUpperCase()) {
                case 'BIMESTRIEL':
                    facteurLissage = 2;
                    break;
                case 'TRIMESTRIEL':
                    facteurLissage = 3;
                    break;
                case 'SEMESTRIEL':
                    facteurLissage = 6;
                    break;
                case 'ANNUEL':
                    facteurLissage = 12;
                    break;
                case 'MENSUEL':
                default:
                    facteurLissage = 1;
                    break;
            }
            
            return montantHT / facteurLissage;
        }

        function calculerAnalytics() {
            console.log('üßÆ Calcul des analytics...');
            
            // Reset des totaux
            analytics.totalRecettesLissees = 0;
            analytics.totalChargesLissees = 0;
            
            // ========================================
            // CALCUL RECETTES LISS√âES
            // ========================================
            recettesData.forEach(recette => {
                const montantLisse = calculerMontantLisse(recette);
                analytics.totalRecettesLissees += montantLisse;
            });
            
            // ========================================
            // CALCUL CHARGES LISS√âES
            // ========================================
            chargesData.forEach(charge => {
                const montantLisse = calculerMontantLisse(charge);
                analytics.totalChargesLissees += montantLisse;
            });
            
            // ========================================
            // CALCULS D√âRIV√âS
            // ========================================
            analytics.resultatMensuel = analytics.totalRecettesLissees - analytics.totalChargesLissees;
            
            analytics.ratioChargesRecettes = analytics.totalRecettesLissees > 0 
                ? (analytics.totalChargesLissees / analytics.totalRecettesLissees) * 100 
                : 0;
            
            analytics.margeOperationnelle = analytics.totalRecettesLissees > 0 
                ? (analytics.resultatMensuel / analytics.totalRecettesLissees) * 100 
                : 0;
            
            analytics.equilibreFinancier = analytics.resultatMensuel >= 0 ? "ATTEINT" : "NON ATTEINT";
            
            // LOG R√âSULTATS
            console.log('üìä === R√âSULTATS ANALYTICS ===');
            console.log(`üí∞ Recettes liss√©es: ${Math.round(analytics.totalRecettesLissees)}‚Ç¨`);
            console.log(`üí∏ Charges liss√©es: ${Math.round(analytics.totalChargesLissees)}‚Ç¨`);
            console.log(`üìä R√©sultat mensuel: ${Math.round(analytics.resultatMensuel)}‚Ç¨`);
            console.log(`üéØ TARGET ATTEINT: ${Math.round(analytics.resultatMensuel) === 9094 ? '‚úÖ OUI' : '‚ùå NON'}`);
        }

        function afficherResultats() {
            // Mise √† jour des m√©triques principales
            document.getElementById('totalRecettes').textContent = 
                `‚Ç¨ ${Math.round(analytics.totalRecettesLissees).toLocaleString()}`;
            
            document.getElementById('totalCharges').textContent = 
                `‚Ç¨ ${Math.round(analytics.totalChargesLissees).toLocaleString()}`;
            
            const resultatElement = document.getElementById('resultatMensuel');
            resultatElement.textContent = `‚Ç¨ ${Math.round(analytics.resultatMensuel).toLocaleString()}`;
            resultatElement.className = `metric-value ${analytics.resultatMensuel >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('ratioCharges').textContent = 
                `${analytics.ratioChargesRecettes.toFixed(1)} %`;
            
            // Mise √† jour timestamp
            const maintenant = new Date();
            document.getElementById('derniereMiseAJour').textContent = 
                maintenant.toLocaleString('fr-FR');
            
            // Mise √† jour info calcul
            document.getElementById('infoCalcul').textContent = 
                `√âquilibre : ${analytics.equilibreFinancier} ‚Ä¢ Marge : ${analytics.margeOperationnelle.toFixed(1)}%`;
            
            // Pr√©parer pour impression
            document.getElementById('dateImpression').textContent = maintenant.toLocaleDateString('fr-FR');
            document.getElementById('heureImpression').textContent = maintenant.toLocaleTimeString('fr-FR');
        }

        function afficherRepartitions() {
            // ========================================
            // R√âPARTITION RECETTES
            // ========================================
            const repartitionRecettes = document.getElementById('repartitionRecettes');
            if (recettesData.length === 0) {
                repartitionRecettes.innerHTML = '<p class="text-muted">Aucune recette active trouv√©e</p>';
            } else {
                let htmlRecettes = '<div class="table-container"><table class="table table-sm">';
                htmlRecettes += '<thead><tr><th>Client</th><th>Montant Liss√© HT</th><th>%</th></tr></thead><tbody>';
                
                recettesData.forEach(recette => {
                    const montantLisse = calculerMontantLisse(recette);
                    const pourcentage = (montantLisse / analytics.totalRecettesLissees) * 100;
                    
                    htmlRecettes += `
                        <tr>
                            <td>${recette.client || 'Client non d√©fini'}</td>
                            <td>‚Ç¨ ${Math.round(montantLisse).toLocaleString()}</td>
                            <td>${pourcentage.toFixed(1)}%</td>
                        </tr>
                    `;
                });
                
                htmlRecettes += '</tbody></table></div>';
                repartitionRecettes.innerHTML = htmlRecettes;
            }
            
            // ========================================
            // R√âPARTITION CHARGES
            // ========================================
            const repartitionCharges = document.getElementById('repartitionCharges');
            if (chargesData.length === 0) {
                repartitionCharges.innerHTML = '<p class="text-muted">Aucune charge active trouv√©e</p>';
            } else {
                let htmlCharges = '<div class="table-container"><table class="table table-sm">';
                htmlCharges += '<thead><tr><th>√âl√©ment</th><th>Montant Liss√© HT</th><th>%</th></tr></thead><tbody>';
                
                chargesData.forEach(charge => {
                    const montantLisse = calculerMontantLisse(charge);
                    const pourcentage = analytics.totalChargesLissees > 0 
                        ? (montantLisse / analytics.totalChargesLissees) * 100 
                        : 0;
                    
                    htmlCharges += `
                        <tr>
                            <td>${charge.element || '√âl√©ment non d√©fini'}</td>
                            <td>‚Ç¨ ${Math.round(montantLisse).toLocaleString()}</td>
                            <td>${pourcentage.toFixed(1)}%</td>
                        </tr>
                    `;
                });
                
                htmlCharges += '</tbody></table></div>';
                repartitionCharges.innerHTML = htmlCharges;
            }
            
            // ========================================
            // TABLEAU D√âTAILL√â TOUTES OP√âRATIONS
            // ========================================
            const tbody = document.getElementById('listeOperations');
            let htmlOperations = '';
            
            // Ajouter recettes
            recettesData.forEach(recette => {
                const montantLisse = calculerMontantLisse(recette);
                htmlOperations += `
                    <tr>
                        <td><span class="status-badge" style="background: #d4edda; color: #155724;">RECETTE</span></td>
                        <td>${recette.client || 'Client non d√©fini'} - ${recette.element || '√âl√©ment non d√©fini'}</td>
                        <td class="positive">‚Ç¨ ${Math.round(recette.montantHT || 0).toLocaleString()}</td>
                        <td>${recette.periodicite || 'MENSUEL'}</td>
                        <td><span class="status-badge status-actif">${recette.statut || 'ACTIF'}</span></td>
                        <td class="positive">‚Ç¨ ${Math.round(montantLisse).toLocaleString()}</td>
                    </tr>
                `;
            });
            
            // Ajouter charges
            chargesData.forEach(charge => {
                const montantLisse = calculerMontantLisse(charge);
                htmlOperations += `
                    <tr>
                        <td><span class="status-badge" style="background: #f8d7da; color: #721c24;">CHARGE</span></td>
                        <td>${charge.element || '√âl√©ment non d√©fini'}</td>
                        <td class="negative">‚Ç¨ -${Math.round(Math.abs(charge.montantHT || 0)).toLocaleString()}</td>
                        <td>${charge.periodicite || 'MENSUEL'}</td>
                        <td><span class="status-badge status-actif">${charge.statut || 'ACTIF'}</span></td>
                        <td class="negative">‚Ç¨ -${Math.round(montantLisse).toLocaleString()}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = htmlOperations || '<tr><td colspan="6" class="text-muted">Aucune op√©ration trouv√©e</td></tr>';
        }
    </script>
</body>
</html>
